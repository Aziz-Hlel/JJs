generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
  SUPER_ADMIN
  STAFF
}

enum Status {
  ACTIVE
  INACTIVE
  DISABLED
  DELETED
}

model User {
  id              String  @id @default(uuid())
  authId          String  @unique
  email           String? @unique
  provider        String
  username        String?
  role            Role    @default(USER)
  isEmailVerified Boolean @default(false)
  status          Status  @default(ACTIVE)

  profile Profile?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  referenceCode String @unique @db.VarChar(6)
  points        Int    @default(0)

  transactionHistories      TransactionHistory[] @relation(name: "UserTransactionHistory")
  staffTransactionHistories TransactionHistory[] @relation(name: "StaffTransactionHistory")
}

enum OfferStatus {
  ACTIVE
  INACTIVE
}

model Offer {
  id          String      @id @default(uuid())
  code        String      @unique
  title       String
  description String
  points      Int
  status      OfferStatus @default(ACTIVE)
  isFeatured  Boolean     @default(false)

  thumbnailId String? @unique
  thumbnail   Media?  @relation(fields: [thumbnailId], references: [id], onDelete: SetNull)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  transactionHistories TransactionHistory[]
}

enum PointsTransactionType {
  EARN
  REDEEM
}

model TransactionHistory {
  id String @id @default(uuid())

  type   PointsTransactionType
  points Int

  offerId String?
  offer   Offer?  @relation(fields: [offerId], references: [id], onDelete: SetNull)

  userId String
  user   User   @relation(name: "UserTransactionHistory", fields: [userId], references: [id], onDelete: Cascade)

  staffId String
  staff   User   @relation(name: "StaffTransactionHistory", fields: [staffId], references: [id], onDelete: Cascade)

  metadata Json?

  createdAt DateTime @default(now())
}

model Profile {
  id          String  @id @default(uuid())
  phoneNumber String?
  address     String?
  avatar      String?

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum MediaStatus {
  PENDING
  CONFIRMED
  DELETED
  FAILED
}

model Media {
  id       String      @id @default(uuid())
  key      String      @unique
  baseName String
  fileType String
  mimeType String
  fileSize Int?
  status   MediaStatus @default(PENDING)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  confirmedAt DateTime?

  product Product? @relation
  offer   Offer?   @relation
  entertainment Entertainment? @relation
}

enum ProductStatus {
  AVAILABLE
  OUT_OF_STOCK
  DISCONTINUED
}

model Product {
  id          String        @id @default(uuid())
  name        String        @unique
  description String
  price       Decimal       @db.Decimal(10, 2)
  status      ProductStatus @default(AVAILABLE)

  thumbnailId String? @unique
  thumbnail   Media?  @relation(fields: [thumbnailId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model KaraokeSong {
  id     String  @id @default(uuid())
  title  String  @unique
  artist String?
  album  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}




model Entertainment {
  id String @id @default(uuid())
  name String
  description String
  date String
  

  thumbnailId String? @unique
  thumbnail   Media?  @relation(fields: [thumbnailId], references: [id], onDelete: SetNull)

  isFeatured Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isFeatured])
}